// Generated by CoffeeScript 1.9.2
(function() {
  var API, Reader, htmlManager,
    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  API = (function() {
    function API(reddit1) {
      this.reddit = reddit1;
    }

    API.prototype.getSubRedditSection = function(subReddit, section) {
      return this.reddit[section](subReddit);
    };

    return API;

  })();

  htmlManager = (function() {
    function htmlManager() {}

    htmlManager.prototype.redditDomain = 'http://www.reddit.com';

    htmlManager.prototype.listContainer = document.querySelector('.media-list');

    htmlManager.prototype.articleContainer = document.querySelector('.article');

    htmlManager.prototype.emptyContainer = document.querySelector('.empty-list');

    htmlManager.prototype.showList = function() {
      return this.listContainer.className = 'show';
    };

    htmlManager.prototype.hideList = function() {
      return this.listContainer.className = 'hide';
    };

    htmlManager.prototype.showArticle = function() {
      return this.articleContainer.className = 'show';
    };

    htmlManager.prototype.hideArticle = function() {
      return this.articleContainer.className = 'hide';
    };

    htmlManager.prototype.showEmpty = function() {
      return this.emptyContainer.className = 'show';
    };

    htmlManager.prototype.hideEmpty = function() {
      return this.emptyContainer.className = 'hide';
    };

    htmlManager.prototype.createListItem = function(data) {
      var body, comments, container, left, link, obj_link, object, title;
      container = document.createElement('div');
      left = document.createElement('div');
      body = document.createElement('div');
      object = this.getImg(data.thumbnail);
      obj_link = document.createElement('a');
      title = this.getTitle();
      link = document.createElement('a');
      comments = document.createElement('div');
      container.className = 'media';
      left.className = 'media-left';
      body.className = 'media-body';
      object.className = 'media-object';
      title.className = 'media-heading';
      obj_link.setAttribute('href', data.url);
      obj_link.setAttribute('target', '_blank');
      link.setAttribute('href', '/article');
      link.innerText = data.title;
      comments.innerText = 'Комментарии: ' + data.num_comments;
      obj_link.appendChild(object);
      left.appendChild(obj_link);
      title.appendChild(link);
      body.appendChild(title);
      body.appendChild(this.getDate(data.created_utc));
      body.appendChild(this.getAuthor(data.author));
      body.appendChild(comments);
      container.appendChild(left);
      container.appendChild(body);
      return this.listContainer.appendChild(container);
    };

    htmlManager.prototype.createArticle = function(data) {
      var article, comment, comments, text, thumbnail, title;
      article = document.createElement('div');
      comments = document.createElement('div');
      comment = document.createElement('div');
      text = document.createElement('div');
      thumbnail = document.createElement('div');
      title = this.getTitle();
      article.className = 'row';
      comments.className = 'row';
      comment.className = 'col-md-12';
      text.className = 'col-md-8';
      thumbnail.className = 'col-md-4';
      title.innerText = data.title;
      text.appendChild(title);
      text.appendChild(this.getAuthor(data.author));
      text.appendChild(this.getDate(data.created_utc));
      thumbnail.appendChild(this.getImg(data.thumbnail));
      article.appendChild(text);
      article.appendChild(thumbnail);
      comments.appendChild(comment);
      this.articleContainer.appendChild(article);
      return this.articleContainer.appendChild(comments);
    };

    htmlManager.prototype.getAuthor = function(_author) {
      var author;
      author = document.createElement('a');
      author.setAttribute('href', this.redditDomain + '/user/' + _author);
      author.setAttribute('target', '_blank');
      author.innerText = _author;
      return author;
    };

    htmlManager.prototype.getDate = function(_date) {
      var date;
      date = document.createElement('div');
      date.innerText = (new Date(_date * 1000)).toLocaleString();
      return date;
    };

    htmlManager.prototype.getTitle = function() {
      var title;
      title = document.createElement('h4');
      return title;
    };

    htmlManager.prototype.getImg = function(thumbnail) {
      var img;
      img = document.createElement('img');
      img.setAttribute('src', thumbnail);
      return img;
    };

    return htmlManager;

  })();

  Reader = (function() {
    function Reader() {
      this.empty = bind(this.empty, this);
      this.article = bind(this.article, this);
      this.list = bind(this.list, this);
      this.html = new htmlManager();
      this.api = new API(reddit);
      this.setRouting();
    }

    Reader.prototype.setRouting = function() {
      page.base('/');
      page('/', this.empty);
      page('/:r/:subreddit', this.list);
      page('/article/:id', this.article);
      return page();
    };

    Reader.prototype.list = function(ctx) {
      console.log('list', ctx);
      this.html.hideArticle();
      this.html.hideEmpty();
      this.html.showList();
    };

    Reader.prototype.article = function(ctx) {
      console.log('article', ctx);
      this.html.hideList();
      this.html.hideEmpty();
      this.html.showArticle();
    };

    Reader.prototype.empty = function(ctx) {
      console.log('empty', ctx);
      this.html.hideArticle();
      this.html.hideList();
      this.html.showEmpty();
    };

    return Reader;

  })();

  new Reader();

}).call(this);
